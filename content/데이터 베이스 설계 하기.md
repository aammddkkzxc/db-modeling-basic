![image](https://github.com/user-attachments/assets/1ff7cbf2-865b-4e76-be77-7ee24fe9bbb8)![image](https://github.com/user-attachments/assets/edf1e6fb-8931-4def-b847-42972bb642d4)### DB 설계 과정

1. 저장해야 하는 데이터 파악하기
2. 그룹핑해서 분류하기
  - **[예시]**
    - 아이디, 패스워드, 이름, 이메일 → **사용자**
    - 영화 이름, 영화에 출연한 배우, 영화 상영 시간 → **영화**
    - 게시글 제목, 게시글 내용, 게시글 생성 시간 → **게시글**
3. 6가지 규칙 적용시키면서 테이블 분리해나가기


### 설계 규칙들

#### 1. 한 칸에는 한 가지 정보만 들어가도록 만들어라
![image](https://github.com/user-attachments/assets/bd712279-63da-483b-8eb5-bd284089eaaa)

- 한 사람이 여러개의 이메일을 가지고 있는 경우, 위와 같이 저장하게 되면 한 칸에 두 개의 정보가 들어감.
- **테이블을 분리**해야 한다. 그리고, 특정 사용자가 어떤 이메일 들을 가지고 있는지 나타내기 위해 **FK를 사용**한다.
- 이 때 FK를 어떤 테이블에 놓을 지 결정하는 규칙이 있다. 후술 할 예정

<br>

- **FK 위치 잘 못 지킨 예**

![image](https://github.com/user-attachments/assets/31a74813-bb2f-4799-b72b-8f0b4e84aa44)

<br>

- **FK 위치 잘 지킨 예**
  
![image](https://github.com/user-attachments/assets/d2a49335-b352-4629-ab98-796d28192133)

```
이 과정을 보고 데이터베이스 이론에서는 제1정규형이라고 부른다
```

- **한 가지 정보**라는 것은 기획/관점에 따라 달라질 수 있다.
  - 이름에서 박재성 전체를 한가지 정보로 볼 수도 있고, 성과 이름을 나누어서 두가지 정보로 볼 수도 있다.
  - 서비스에 맞게 판단
 
<br>

#### 2. 어떤 테이블에 FK를 넣어도 ‘규칙 1’을 못 지킬 때는 중간 테이블을 하나 더 만들어라

![image](https://github.com/user-attachments/assets/72dab414-9be5-4f5b-8334-1fd0eb5aa9e2)

- 데이터 중복이 발생 했으니 1원칙 대로 테이블을 분리하고 FK를 넣어본다

<br>

![image](https://github.com/user-attachments/assets/4aa1a1e1-2b79-4cbb-ab2d-685a16ec6a19)

<br>

![image](https://github.com/user-attachments/assets/5609f8bb-f901-458e-b4e9-d80d85da73c9)

<br>

- 두 경우 모두 데이터 중복이 발생한다. 이 경우 중간 테이블로 풀어낸다

<br>

![image](https://github.com/user-attachments/assets/6a9a8456-3f7f-472f-9002-4316740ca48a)

- 중간 테이블 이름 -> **관계를 표현해주는 동사**로 작성 하면 좋다
- 어떤 학생이 어떤 과목들을 수강하는 지까지 다 파악할 수 있으며, 규칙 1을 지킬 수 있게된다. 

<br>

#### 3. 헷갈릴 땐 관계(1:1, 1:N, N:M)를 파악해봐라

- 엔티티 간의 관계에서 패턴을 찾은 것. 그게 바로 1:1 관계, 1:N 관계, N:M 관계라는 패턴
```
- A, B의 관점 전부 다 `하나`만 기진다면 → A : B = 1 : 1
- A의 관점에서는 `여러개`의 B를 가지고, B의 관점에서는 `하나`의 A를 가진다면 → A : B = 1 : N
- A의 관점에서는 `하나`의 B를 가지고, B의 관점에서는 `여러개`의 A를 가진다면 → A : B = N : 1
- A, B의 관점 전부 다 `여러개`를 가진다면 → A : B = N : M
```

- 1:N 관계의 특징
  - N에 FK가 들어가야 한다.
- N:M 관계의 특징
  - 중간 테이블이 있어야 한다.
  - 중간 테이블에 두 테이블의 FK가 들어가야 한다.
  - N:M 관계에서 중간 테이블을 추가해 1:N 관계로 바꿔 표현하게 된다.
- 1:1 관계의 특징
  - DB 설계할 때는 1:1 관계가 생각보다 잘 안 나옴
  - 아무 테이블에 FK를 넣어도 된다.
  - 합쳐도 되는 지 고려해봐야 한다. (어지간하면 1:1 관계로 분리하지 않는 걸 추천)
  - 1:1 관계는 각 테이블들을 따로 조회할 일이 많다 싶으면 분리 아니면 그냥 합친다.

<br>

#### 4. 데이터 중복이 발생하는 컬럼이 있는 지 확인해라

![image](https://github.com/user-attachments/assets/ab3b597e-b1e6-43c9-80e8-30ccdb506174)

<br>

- 데이터를 넣다보니 작성자 컬럼에서 중복 데이터가 발생했다. 공부 했듯이 테이블 분리와 FK활용한다

<br>

![image](https://github.com/user-attachments/assets/344c4b15-53d9-4318-abf7-2cfdd0cffae8)


<br>

- 이 구조에서는 박재성이라는 이름을 개명할 때 users 테이블에 있는 딱 1개의 데이터만 수정하면 된다
- FK의 중복은 중복이라고 판단하지 않는 이유?
  - 데이터가 변경되어도 바꿀 필요가 없음.
  - **변경**이 일어날 때 여러개의 값을 바꾸어야 한다 -> 중복 이라고 보면 된다.
 
<br>

#### 5. 가짜 중복과 진짜 중복을 구별해라

<br>

![image](https://github.com/user-attachments/assets/1a2ea626-20ee-48cf-9899-15d39485e9c0)

<br>

- 겉으로만 봤을 땐 제목 컬럼에서도 데이터 중복이 발생한 것처럼 보이고, 내용 컬럼, 작성자 컬럼에서도 데이터 중복이 발생한 것처럼 보인다.
- 하지만 여기서 진짜 데이터 중복이 발생한 컬럼은 작성자 컬럼뿐이다.
  
<br>

- 앞서 말했듯이 **변경의 관점**에서 바라보자
  - 제목 컬럼의 데이터 하나가 변경되면 나머지도 변경되어야 하는가?
    - ㄴㄴ. 우연히 같은 제목 일 수 있고, 그냥 다른 데이터임
  - 내용 컬럼의 데이터 하나가 변경되면 나머지도 변경되어야 하는가?
    - ㄴㄴ. 마찬가지
  - 작성자 컬럼의 데이터 하나가 변경되면 나머지도 변경되어야 하는가?
    - 변경되어야 한다. => 진짜 중복 => 테이블 분리

<br>

![image](https://github.com/user-attachments/assets/0c5b601a-f906-4fe8-a69d-6eecd1af6bbe)

<br>

#### 6. 숨어있는 중복을 찾아라

- 이 또한 **변경의 관점** 에서 찾아낼 수 있다.

<br>

![image](https://github.com/user-attachments/assets/db8c66f3-e415-4470-a2ff-2fed88d151f2)

<br>

- 2번 사용자가 1번 게시글의 좋아요를 삭제했다고 해보자.
- 그러면 likes 테이블에서 데이터만 삭제하면 될 줄 알았는데, 테이블 구성을 다시 보니 게시글의 좋아요 수의 값도 수정해주어야 한다.
- 결국 특정 데이터를 수정할 때, 다른 데이터도 같이 수정해주어야 하는 상황이다. 데이터 중복이 발생했을 때와 동일한 단점이 발생한다.
- 이를 숨어있는 중복 이라고 한다. => 테이블 분리

<br>

![image](https://github.com/user-attachments/assets/23948287-ed57-4206-8268-684b6c0beddb)

<br>

- 좋아요 수는 likes 테이블 활용해서 카운팅 쿼리
- 합계 평균 등 통계형에서 주로 나타남
- 숨어있는 중복을 제거하지 않고 그냥 좋아요 수 칼럼을 사용하는 경우도 있는데, 이를 역 정규화 라고 한다.
- 성능의 문제가 발생할 때 사용. 트레이드 오프
